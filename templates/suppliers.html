{% extends "_layout.html" %}

{% block title %}Manage Suppliers{% endblock %}

{% block content %}
<style>
    .container { display: grid; grid-template-columns: 2fr 1fr; gap: 40px; align-items: start;}
    table { table-layout: fixed; }
    th:nth-child(1) { width: 30%; } /* Name */
    th:nth-child(2) { width: 25%; } /* Contact */
    th:nth-child(3) { width: 30%; } /* Email/Phone */
    th:nth-child(4) { width: 15%; } /* Actions */

    .actions-cell { display: flex; gap: 10px; align-items: center; }
    .action-form { margin: 0; display: flex; align-items: center; }
    .edit-btn, .delete-btn { font-size: 0.9em; padding: 6px 12px; }
    textarea { min-height: 80px; }
    input[type="text"], input[type="email"], input[type="tel"], input[type="url"], textarea {
        width: 100%;
    }
</style>

<h1>Manage Suppliers</h1>
<p>Add, edit, or remove ingredient suppliers.</p>

{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
        <div classclass="flash-{{ category }}">{{ message }}</div>
        {% endfor %}
    {% endif %}
{% endwith %}

<div class="container">
    <div class="list-container content-card">
        <h2>Existing Suppliers</h2>
        {% if suppliers %}
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Contact Person</th>
                    <th>Contact Info</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for supplier in suppliers %}
                <tr>
                    <td>
                        {% if supplier.website %}
                            <a href="{{ supplier.website }}" target="_blank" rel="noopener noreferrer">{{ supplier.name }}</a>
                        {% else %}
                            {{ supplier.name }}
                        {% endif %}
                    </td>
                    <td>{{ supplier.contact_person or 'N/A' }}</td>
                    <td>
                        {% if supplier.email %}<a href="mailto:{{ supplier.email }}">{{ supplier.email }}</a><br>{% endif %}
                        {{ supplier.phone or '' }}
                    </td>
                    <td class="actions-cell">
                        <form class="action-form" method="GET" action="{{ url_for('edit_supplier', id=supplier.id) }}">
                            <button type="submit" class="edit-btn">Edit</button>
                        </form>
                        <form class="action-form" method="POST" action="{{ url_for('delete_supplier', id=supplier.id) }}" onsubmit="return confirm('Are you sure? Deleting may fail if supplier is linked to orders.');">
                            <button type="submit" class="delete-btn">Delete</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
         <p>No suppliers added yet.</p>
        {% endif %}
    </div>

    <div class="form-container content-card">
        <h2>Add New Supplier</h2>
        <form method="POST" action="{{ url_for('add_supplier') }}">
            <div>
                <label for="name">Supplier Name</label>
                <input type="text" id="name" name="name" required>
            </div>
            <div>
                <label for="contact_person">Contact Person (Optional)</label>
                <input type="text" id="contact_person" name="contact_person">
            </div>
             <div>
                <label for="email">Email (Optional)</label>
                <input type="email" id="email" name="email">
            </div>
             <div>
                <label for="phone">Phone (Optional)</label>
                <input type="tel" id="phone" name="phone">
            </div>
            <div>
                <label for="website">Website (Optional)</label>
                <input type="url" id="website" name="website" placeholder="https://...">
            </div>
             <div>
                <label for="notes">Notes (Optional)</label>
                <textarea id="notes" name="notes"></textarea>
            </div>
            <button type="submit" class="submit-btn">Add Supplier</button>
        </form>
    </div>
</div>
{% endblock %}