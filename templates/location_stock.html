{% extends "_layout.html" %}

{% block title %}Finished Product Stock{% endblock %}

{% block content %}
<style>
    .container {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 40px;
    }
    table { table-layout: fixed; }
    th:nth-child(1) { width: 30%; } /* Location */
    th:nth-child(2) { width: 45%; } /* Product */
    th:nth-child(3) { width: 25%; } /* Quantity */

    @media screen and (max-width: 1100px) {
        .container {
            grid-template-columns: 1fr;
        }
    }
</style>

<h1>Manage Finished Product Stock</h1>
<p>Set the exact number of finished jars you have in stock at each fulfillment location.</p>

{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
        <div class="flash-{{ category }}">{{ message }}</div>
        {% endfor %}
    {% endif %}
{% endwith %}

<div class="container">
    <div class="list-container content-card">
        <h2>Current Finished Stock</h2>
        <table>
            <thead>
                <tr>
                    <th>Location</th>
                    <th>Product (SKU)</th>
                    <th>Quantity On Hand</th>
                </tr>
            </thead>
            <tbody>
                {% for item in current_stock %}
                <tr>
                    <td>{{ item.location_name }}</td>
                    <td>{{ item.product_name }} ({{ item.sku }})</td>
                    <td>{{ item.quantity }}</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="3" style="text-align: center;">No finished stock levels set.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="form-container content-card">
        <h2>Set / Update Stock</h2>
        <form method="POST" action="{{ url_for('location_stock_page') }}">
            <div>
                <label for="location_id">Select Location</label>
                <select id="location_id" name="location_id" required>
                    <option value="" disabled selected>-- Choose a location --</option>
                    {% for loc in locations %}
                        <option value="{{ loc.id }}">{{ loc.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label for="product_id">Select Product</label>
                <select id="product_id" name="product_id" required>
                    <option value="" disabled selected>-- Choose a product --</option>
                    {% for prod in products %}
                        <option value="{{ prod.id }}">{{ prod.product_name }} ({{ prod.sku }})</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label for="quantity">Quantity</label>
                <input type="number" id="quantity" name="quantity" min="0" required value="0">
            </div>
            <button type="submit" class="submit-btn">Set / Update Quantity</button>
        </form>
    </div>
</div>
{% endblock %}